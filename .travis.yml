env:
  global:
  - secure: c3OrsEwYJ/g7zZmeEhG3A06jwk9rr8qDAnI43znyLlgGMuym9EViwM/yAScWz9tb6KjkkIss3VkYeV0bcQKgCE8HVrr49lZgAj28/Japa5TbidQ3tizDFr4KhRMOiI5ZnUD8X+NqOAuhZ7ulQ/AYDqOmeNoKbKVtBNimdjGuGbI6vwjrSwEhUhTZavOP9px0UfG/VI0ZBIeoJIeorGnAv/MKCMgk5HfSaoL692CWDpESis2a68pTeedHSRBCs4aM3BU++szdst2JEQ2qVbpF4ta+bvfLngjZazQsO53erHchWKUP/yqUdS89ZG8PM/yIBsDwcUgbcuy8WQpH7qCW/QN/GlDCug5I+aLfOSBpo92lWtp3RZiP/vvG8WguBSshr4zM+LcppW74NFs8REBOzeD978QSiS0//639Oa/jJaU2zpp+zGf/T/OUsHuVTh5CngQTtc6UIc6gF9Eqp2FVNcgETJSPoEEGdys6pFOfJblYgJFKB8/0LvZJSXh5p5MuleqSk+VJr6gxXyDDFwx9K+CwoejmnUgCEwJaSv6w0HeJdJV3lrnFWivHx/NG4Wg8DlRu/uSR8Kvgwg2hiihMmHyCeWA7BbRBSe5S/y3R5wULjBoNkFcoVRac2UVvWCxZ7170KxwyHO3DVCbEpVUr6Y20Z+SQA3Lgko0sVTcE8q4=
  - secure: 14MqW8PG56KvOnMGTV8jKrzMKjsR5CF6vUW+xLBYls61e1ptX86ElLd0SzaxEkoyLUQ7RNdWDNyW0tKTlpUdgJU1osdYTPMl9L/6nc2i0vH78MJVwN0DJBmou2f3mp21foOoKQVkYc8nYfNsNvXb0DAddRH2M7xcFNS++88qoWRjw6ACMnrH1vFWm1icI17Wd8zhjZqFsOeJIF4rnzcavZMZnhxd/gp+QTfyoh1QtPnlO6h3wYprhKjGubPW+j34N7y0bskuPLHDpjKTeXWZmfvObO9S2C7UZ0CjtOxj1jTyXloar50m/qegkO8EVvOnxFmDhMXR647tManCme3/AxYtwsOpBY/fbs5kp4TMoZXlXQBJLGPTXDlTlRYAtRU8no7pazMp4xP4TvGk5HQ4UIztIZS/ZeHYTIGF/NQALU+XbQcQtT3wNn5LZxpod+JSaad1VJDaM7YUuh2wQroABalX00tGgvkXm3bL1yxIs82OonSA7jGCwaFmAU8rO/ZTCLC9GbO1+BL09J1LBxp+wIfqYiahSnTelxUBeXLkn4ktVn/fk2GZBUaBcTv/YYRoNOc6BvJkB3acsK4GDoDrhQEbkv9H6WDJ6e43vTsbfKV72smJ5JvXJZvB23VUFqFVVGN5tLMDE1e+mkwHFZ4aZ0q3hcU9nl7v2yXoVTObUPQ=
  - secure: JEYD3nhS8hgZI8Mcz4cO/w5J+EMwK0qU84cqHimP27YguySRgWtb6OyVQ1Jvt4bwPDWtf8RqqCYRRRUfxFtv3KtDUZyYRspcvQoCDmakea3HF2dzAe+8xFYa5KmHzMI1Z1pFND06/chdIOUMEZ0OMxc10SJzDNdOw2ZWolWXqBpb9PBV/mQz9XQsGjuzDlSfpsnLetP77seXVF7bqXCK0dqUukLqO1llyF06s8FsDqLDYyA3cZ8TlhRjCZm8qbtvI+6yC490f42VWWXIDKlD+a5hVEhOo/N5V50x1r0ltOipAIjZLxRxNI9FVk7c4FdQ5qw+uUuciW9tgM47kUCx7zWtYKJDlThnQf/RKSGhkbOoYeHzggqjkBdPe2jHIRPhzaL6VuLlM8brZa58hd91cETvRoshwIlJpG9UaRn+hr9HdPR3HQsTFHsxtE5fhRFPv4DlVl9b5HByZDydmJHuGyoYmR4LmTJqpvxnMZyisoUZdMhBXdelleaPQKhM2oDKBYD2qIHRy/Fx+tg5AKG7ieWVRrI3CTQ/IbwaHe/p4U4AO9EXnn8O3I/2EJZnzKwNjNkgrMx4zkEpXyKs2OdR0LRaF26Ifb42f4m3jfDe6hzNNZcrQpfwKJQktXf+t7bfMp/97WqV8aaNcW8GzWJBRZIy0xClUHLUYUDqaKJF5G0=
  - secure: xBS1jOONOPwe59lUtJ3uoV6HiWcybqitSYuYQaYmQojTSr/iOyc3a1hU8540PcRp/pyigTI5TkWVU+OOVbjs/qFTzhSe7FV3V8u1yNZTBKjmbiymctm9MSwecHM51R58Ddr2ho8cagPC84GfUNruL6vAhVd8Xiso5lI5mhAjlagyoIFqv7p3MbuNQKmfhLo3wP3zFFaOd5PCJT0DRV69zzUo2MbY18OzJ3lrkqmNo8V2Uq4XBWKpG7G28u3vv9kq3NLvSyNPYTpscd4TO0eWlwdMfcNODUdX0w5AWeB/yMiFMKY4Cfy8byqPoyPfXFzew+ea8rNCF3kIoRxvx7wm3L7PoMumNw1ghLZGlcYWlQebJ3DFIIoVCWKw6Y84WF8Eia8Pst4nSUCxu17Rmy7RZzKWLmeaZXh+uSrmv0BkQdyL3cF3vMPidK/6QSmBpddT38dbOTZ10Awcgpk+EyY/dGDgiSPDdqbAWk9Eaji4/HCmUJa8MjEwCtBDg5/qWc6ff2rBzm0ecb61xAO32lQFRS3p/9FHTDdXr3XM7UjiC8a8oUoiCJSemHzR7H9XlMSu0NzASSUCre0nDlXIpXirAB2Fy+yh4VZ/Eb+5KbGvNU9o6EaZAFdkxPae7XqEbP1UDOnC/SzkjSQ9xvkLGPleOyO85GvKKm2niYWzY9WmUyk=
  - secure: 1CsiwpxvBJoHnT5tXpk4oTuvEydtIpGJQ3efPozhwMI6mwN6FtzspwZmvo01484cUUUMh7Zm8GhMvRkvD4WDYNsKWnH24ykghVpfvyJNNEv34dPzk4c4iozuK8yDRL5YHh8GBQRZcean73DPU2NrePwEefDHDMTfJ0Dk/YpvPcwm2wyI11bES08FPO8AriCx5Yj6+YyRil8Ap6ZBt1JWURnQXShs0M7pzxsH4z9qaXePwoR2qEupYxUIqiKVpoK+rFyiv066G2VH74fme439nMblD6O8AyP5Y4BFg1jLlIr7dnPBGfnE6jKfm+nljyZpaf/ueGPp/XNvCvnz3hCyL9+K2sR6M7H3dPoYbDef8zpFEK5sQLCTUe4kgHSeUoV37dtiJkCs2qLFU5qHX/NjZxnZ3ErLZtnxhuTLo8aFR51kEfRvmRj2ZwwZ8ur+dKqizSZP1+8QwQaZTOwS1XCBd+K8B4Hk0onqviUZXqZgy5YIQtnB6hWMsvDBBHX1GqhJRcznlyhAJbTEvobVNbSOy8QecUvMDDDrue82i6eREfk4ryyyAsmmo6Q0kwf4K6cSU91jzr0MQip8eHfrq3HQmrERXrh4Rwc2kQij0Q0eL6VX/7WTBDOPQN6N/AfUHvn2QXhCeR95lBTc2WtcHwiRryuca0RPQ+orbhl47El9I4s=
  - secure: AOoVOqfm+P9VFEE0ZAE26DPSNbQK2tlQZQXCZxcGM4vR7EwgSXqiE5ZcMIVI7DHmFSbQcqSwsaaazfvMB/drVHuS/V5M6uqteUpLhwAZvZUgnB8VF8z+lXKB7Bk4+9wPqNU6Y4IT5irJbjbk2Iyl1QX2Thb65azOXz0hqbpe3uhgIhb0BgobP/waiC8UJnu7KOX791PyApqe9HbKkguEra/Ag5Ja6S98JyGdIS7AWHS+nacOMOPeF6Qo1ur+s2Um+/E/Dm2wWeoc92bC07AhDbGcEFbaR5VpRX8wjPMbHF5UoOU/AY9kyU8URGJf1XLBZScO38mLBx2eRgpWXpttbCgLda8zDtmBkY5Lyb1DSza7Cj1wsANfN7ENI4wrftHwoGC7crYp7yniKJr4crdM7X/a3mX2z8gcB4Z8jexTZ6hLfOjjvutWIb1fPUcZSecA8G/3dhS/nhVxMAKCTXJnvkEaomltgwjLOVspyFm0CYmcHkXlKEutEOB8eU+dhKvaIogA0RJRxoYCi8Iyn3VQHZncL93xauobuIvJT//Y93azzvdWUOF7nBQ3bXmjX1vuq7ZLmHYlyEz5HTcyp7cm8zhfeVRYJwHoUxVXJDLuo2zrzB5un+BXkFW1VR2z33np0WG7YQCD4GrnfFSuxdGlqyZZpbcJLJGj9jzPIeFWpGM=
  - secure: pE6csTUucn6SfM0wwPTQn1MVrvkI9zfH/bBjGaZ3ZVW9jaaAjAo+elo9BxMwqfGE/WvasCnxUQ//xaKEFNWmxvMHvDNCDnaHrYAfTA3J6NPzSsHy/hafSkk+f9k+OiIsNVOzK4bKZXu+3V0nx20iGPns41luYhrpJgVhTxdLHNqwP52wxBq9nV4cRDYn+AH2epooE3r2YEjLXAixQEaLdw+NTMKiFc2EbjL496rMA18w3r7kOW0RP85Qm6ycuOWejYaiMwd72MvLBxJ53hja5TC57Jair63rXeC2gjVDRDa4w9dFNk3lPYhg/BkzkZ7Q7Pt/OlT61T+Nx3FEvdKIt3ETCaZMyye944yGoSJeazbBBPfoi1uN/a6GET9whrdGOFL408BiMCnJmIc68LWvEEdSSeacfiGutV329r6WK2QNCHU6J8vejr9i72OybF4+oTHJE9h+zTcVTT3fRJn92KDS/y8gmyHSokuWN/xDPOJTfdnpjMh6DfvuQM+0P5WITdcsYNyWqnRb4uRKeXVq0I9Oj4oZyH1bxI0s1wX6ym/ahLsN1bb7cJNnnWv9JpzzNr4LZMPIDrw+MUmABFjulHi7bSyjcx5vUsGFMmUdxwuvbO1v1WCKivDx+/i+ssRR0zDf0GoqXvw+IUt+QIMB/7nr9xHs6MEUzptTwwJilvE=
sudo: required
language: java
services:
- docker
branches:
  except:
  - "/^dockerfile-image-update-.*$/"
script:
- mvn --quiet --batch-mode verify
- docker build -t salesforce/dockerfile-image-update .
- echo git_api_token=${ITEST_GH_TOKEN} > `pwd`/itest.env
- export user_itest_secrets_file_secret=`pwd`/itest.env
- docker-compose up #--abort-on-container-exit TODO: remove this once itests can be made not to flap see issue #21
- rm itest.env
cache:
  directories:
  - "~/.m2/repository"
after_success:
- mvn coveralls:report
deploy:
  provider: script
  script: sh $TRAVIS_BUILD_DIR/.travis.deploy.sh
  skip_cleanup: true
  on:
    branch: master
